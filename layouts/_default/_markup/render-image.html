{{/* https://discourse.gohugo.io/t/simple-image-render-hook-template-for-responsive-images/22464 */}}
{{ $image := .Page.Resources.GetMatch (printf "%s" (.Destination | safeURL)) }}
{{ $small := $image.Resize "360x webp" }}
{{ $alt := .PlainText | safeHTML }}
{{ $caption := "" }}
{{ with .Title }}
  {{ $caption = . | safeHTML }}
{{ end }}

<a href="{{ $image.RelPermalink }}">
  <img
    src="{{ $small.RelPermalink }}"
    width="{{ $small.Width }}"
    height="{{ $small.Height }}"
    alt="{{ if $alt }}{{ $alt }}{{ else if $caption }}{{ $caption | markdownify | plainify }}{{ else }}{{ end }}"
    >
</a>
{{ with $caption }}
<br>{{ . | markdownify }}
{{ end }}